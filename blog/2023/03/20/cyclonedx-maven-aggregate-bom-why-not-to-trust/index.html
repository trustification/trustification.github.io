<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">The CycloneDX Maven Aggregate SBOM and why you shouldn&#x27;t trust it (yet) | Trustification</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://trustification.io/img/logo.svg"><meta data-rh="true" name="twitter:image" content="https://trustification.io/img/logo.svg"><meta data-rh="true" property="og:url" content="https://trustification.io/blog/2023/03/20/cyclonedx-maven-aggregate-bom-why-not-to-trust"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="keywords" content="supply chain, sbom, vex"><meta data-rh="true" property="og:title" content="The CycloneDX Maven Aggregate SBOM and why you shouldn&#x27;t trust it (yet) | Trustification"><meta data-rh="true" name="description" content="Over the last few months I&#x27;ve spent a lot of time with the CycloneDX Maven Plugin, trying to prove it is suitable for us to use as part of securing the Software Supply Chain. I&#x27;ve discovered and fixed a number of issues, related to the generation of an SBOM for each project using the makeBom goal, and have now turned my focus to aggregates and the makeAggregateBom goal."><meta data-rh="true" property="og:description" content="Over the last few months I&#x27;ve spent a lot of time with the CycloneDX Maven Plugin, trying to prove it is suitable for us to use as part of securing the Software Supply Chain. I&#x27;ve discovered and fixed a number of issues, related to the generation of an SBOM for each project using the makeBom goal, and have now turned my focus to aggregates and the makeAggregateBom goal."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-03-20T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/kevinconner"><meta data-rh="true" property="article:tag" content="cyclonedx"><link data-rh="true" rel="icon" href="/img/logo.svg"><link data-rh="true" rel="canonical" href="https://trustification.io/blog/2023/03/20/cyclonedx-maven-aggregate-bom-why-not-to-trust"><link data-rh="true" rel="alternate" href="https://trustification.io/blog/2023/03/20/cyclonedx-maven-aggregate-bom-why-not-to-trust" hreflang="en"><link data-rh="true" rel="alternate" href="https://trustification.io/blog/2023/03/20/cyclonedx-maven-aggregate-bom-why-not-to-trust" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://UO35LKIYPP-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Trustification RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Trustification Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-HWS6R519CF"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-HWS6R519CF",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Trustification" href="/opensearch.xml">

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Red+Hat+Text&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Red+Hat+Text:wght@400;700&display=swap"><link rel="stylesheet" href="/assets/css/styles.17054ea6.css">
<link rel="preload" href="/assets/js/runtime~main.9aa82a53.js" as="script">
<link rel="preload" href="/assets/js/main.a8b28ef1.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Trustification Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="Trustification Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Trustification</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/trustification" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/2023/03/20/cyclonedx-maven-aggregate-bom-why-not-to-trust">The CycloneDX Maven Aggregate SBOM and why you shouldn&#x27;t trust it (yet)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/03/13/in-toto-attestations">in-toto attestations</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/02/13/elfsign">Signing elf binaries, or not?! Lessons learned.</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/02/10/cyclonedx-maven-plugin-adventure-continues">Continuing the Adventure with the CycloneDX Maven Plugin</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/01/31/tuf">The Update Framework (TUF)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/01/25/keys">Is this a cryptographic key which I see before me?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/01/13/sigstore-bundle-format">Sigstore bundle format</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/01/11/sigstore-in-toto-opa">Sigstore, in-toto, OPA, orientation</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/12/09/cyclonedx-maven-plugin-adventure">An Adventure with the CycloneDX Maven Plugin</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/12/05/gitsign-cache">How to Configure a Gitsign Cache</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">The CycloneDX Maven Aggregate SBOM and why you shouldn&#x27;t trust it (yet)</h1><div class="container_mt6G margin-vert--md"><time datetime="2023-03-20T00:00:00.000Z" itemprop="datePublished">March 20, 2023</time> Â· <!-- -->13 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/kevinconner" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/kevinconner.png" alt="Kevin Conner"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/kevinconner" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Kevin Conner</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer</small></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p>Over the last few months I&#x27;ve spent a lot of time with the <a href="https://github.com/CycloneDX/cyclonedx-maven-plugin" target="_blank" rel="noopener noreferrer" title="The CycloneDX Maven Plugin GitHub repository">CycloneDX Maven Plugin</a>, trying to prove it is suitable for us to use as part of securing the Software Supply Chain. I&#x27;ve discovered and fixed a number of issues, related to the generation of an SBOM for each project using the <code>makeBom</code> goal, and have now turned my focus to aggregates and the <code>makeAggregateBom</code> goal.</p><p>I&#x27;ll start this post with a description of what I believe an aggregate SBOM should contain. This may be different to what you are looking for, if so I would like to hear about your expectations and tailor my fix to address your needs. In any case I believe the issues I am about to describe will likely impact yourselves and create enough doubt in the accuracy of the aggregate SBOM for you to decide not to trust it.</p><h1>What do I expect from an Aggregate SBOM?</h1><p>Generating an SBOM for an individual project is fairly straight forward, you run the <code>makeBom</code> goal and create an SBOM representing the <code>build time</code> dependency graph for your component. You can choose to filter certain artifacts and/or scopes from the SBOM, however the dependency resolution will still be impacted by all the dependencies within the project.</p><p>When generating SBOMs for a multi-module project you have two choices</p><ul><li>generate an SBOM for each individual project</li><li>generate an aggregate SBOM which represents all projects within your multi-module project</li></ul><p>My expectation is the aggregate SBOM would be an aggregate of all the individual SBOMs, in other words each component present in the individual SBOMs should be present in the aggregate SBOM and each dependency tree represented in the individual SBOMs should also be present in the aggregate SBOM.</p><h1>What do we get from the current aggregate SBOM?</h1><p>Before we describe what happens it is important to understand the CyloneDX specification requires a component to specify a <code>bom-ref</code> attribute if the component is to be referenced elsewhere in the SBOM, with the <code>bom-ref</code> being unique across the set of components. The CycloneDX maven plugin will always generate a <code>bom-ref</code> for each component, currently the same as the component purl, and will use this reference when creating the dependency hierarchy.</p><p>Now to the details.</p><p>When generating an aggregate SBOM the plugin will iterate over all the projects within the multi-module build (the reactor), generate an SBOM for each project and combining this with the previous SBOMs. It will continue until each project within the reactor has been processed, resulting in an aggregate SBOM. On the surface this appears to be the right thing to do, all components and all dependencies should be included in the SBOM and this is what we want ..... only the details are more subtle.</p><p>What actually happens when we combine the components and dependencies from a project is the plugin will iterate over each component, adding it to the set of known components if it has not previously encountered its <code>bom-ref</code>, and in the case of dependencies it will add all project dependencies to the set of known dependencies within the aggregate. Now I know what you are thinking! This still appears to be correct, so where is it going wrong? To understand that we need to look at the <code>Dependency</code> class.</p><p>The <code>Dependency</code> class defines equality only on the content of its ref attribute, so when adding dependencies to a <code>Set</code> the following are considered to be the same.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency ref=&quot;pkg:maven/com.example.dependency_trees/dependency_B@1.0.0?type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example.dependency_trees/dependency_C@1.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>and</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency ref=&quot;pkg:maven/com.example.dependency_trees/dependency_B@1.0.0?type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example.dependency_trees/dependency_C@2.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>What this means is the first dependency added to the set of all dependencies will be the winner, will be part of the generated SBOM, and all subsequent dependency hierarchies will be lost. But wait, shouldn&#x27;t a component always have the same dependencies on other components? This is certainly the assumption made in the plugin, unfortunately it is not a valid assumption for many reasons and for this we need to look more at how maven handles dependency resolution. Scenarios where this assumption is invalid include</p><ul><li>the component is included in a project with a different set of dependencies</li><li>the component is included in a project which specifies dependencies in a different order</li><li>the component includes dependencies on artifacts with <code>test</code> or <code>provided</code> scope, or includes dependencies on artifacts marked as <code>optional</code></li><li>there is a dependency management section overriding the version of an artifact</li><li>there is a dependency management section excluding dependencies from an artifact</li></ul><p>There are likely more scenarios, however the above are reasonably common and sufficient to demonstrate the problem. In the next sections we will go through examples for each of the top three, ignoring version management, so we can demonstrate how easy it is to fall into this trap and explore the impact on the generated aggregate SBOM.</p><h1>Differing Sets of Dependencies</h1><p>In this scenario we will take a look at a multi-module project where an external project is consumed within the context of differing sets of dependencies. Project <code>dependency_A</code> will consume the artifact we are interested in, <code>dependency_C</code>, alongside a second dependency, <code>dependency_E</code>, which will cause a version conflict which needs to be resolved by the maven conflict resolution mechanism. Project <code>dependency_B</code> will simply consume <code>dependency_C</code> as is, without there being any conflict needing to be resolved.</p><p>Let us now take a look at the dependency hierarchy for both projects, as visualized through the dependency:tree plugin. For <code>dependency_A</code> we see</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">com.example.example1:dependency_A:jar:1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+- com.example.external:dependency_C:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  \- com.example.external:dependency_D:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|     \- (com.example.external:dependency_E:jar:1.0.0:compile - omitted for conflict with 2.0.0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\- com.example.external:dependency_E:jar:2.0.0:compile (scope not updated to compile)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   \- com.example.external:dependency_F:jar:2.0.0:compile</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>and for <code>dependency_B</code> we see</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">com.example.example1:dependency_B:jar:1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\- com.example.external:dependency_C:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   \- com.example.external:dependency_D:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      \- com.example.external:dependency_E:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         \- com.example.external:dependency_F:jar:1.0.0:compile</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the first project we see the maven dependency resolution mechanism has aligned the version of <code>dependency_E</code> referenced in the tree to version <code>2.0.0</code>, this was chosen because this dependency is closer to the root of the tree.</p><p>Let&#x27;s now take a look at what we see in the aggregate SBOM.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency ref=&quot;pkg:maven/com.example.example1/dependency_A@1.0.0?type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_C@1.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_E@2.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_C@1.0.0?type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_D@1.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_D@1.0.0?type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_E@2.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_E@2.0.0?type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_F@2.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_F@2.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency ref=&quot;pkg:maven/com.example.example1/dependency_B@1.0.0?type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_C@1.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_E@1.0.0?type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_F@1.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_F@1.0.0?type=jar&quot;/&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>From the above we see there is a flow matching <code>A1-&gt;C1-&gt;D1-&gt;E2-&gt;F2</code> and <code>A1-&gt;E2-&gt;F2</code>, so the aggregated SBOM correctly represents the dependency hierarchy for <code>dependency_A</code>.</p><p>If we now look at how the dependency tree for <code>dependency_B</code> is represented we see a problem. The representation for <code>dependency_B</code> is a flow from <code>B1-&gt;C1-&gt;D1-&gt;E2-F2</code> which does not match the dependency hierarchy for <code>dependency_B</code>; it should be <code>B1-&gt;C1-&gt;D1-&gt;E1-&gt;F1</code>! Where has the flow <code>E1-&gt;F1</code> gone? Unfortunately this flow is now orphaned with <code>E1</code> being its own root in the SBOM!</p><h1>Differing Order of Dependencies</h1><p>In this scenario we will take a look at a multi-module project where we have two projects consuming the same sets of dependencies, but specifying those dependencies in opposite order within their respective <code>pom.xml</code> files. The first will declare a dependency on <code>dependency_C</code> followed by <code>deependency_D</code> whereas the second will declare a dependency on <code>dependency_D</code> followed by <code>dependency_C</code>. Both <code>dependency_C</code> and <code>dependency_D</code> will consume <code>dependency_E</code> but with different versions, causing a conflict which needs to be resolved.</p><p>Let us now take a look at the dependency hierarchy for both projects, as visualized through the dependency:tree plugin. For <code>dependency_A</code> we see</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">com.example.example2:dependency_A:jar:1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+- com.example.external:dependency_C:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  \- com.example.external:dependency_E:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|     \- com.example.external:dependency_F:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\- com.example.external:dependency_D:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   \- (com.example.external:dependency_E:jar:2.0.0:compile - omitted for conflict with 1.0.0)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>and for <code>dependency_B</code> we see</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">com.example.example2:dependency_B:jar:1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+- com.example.external:dependency_D:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  \- com.example.external:dependency_E:jar:2.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|     \- com.example.external:dependency_F:jar:2.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\- com.example.external:dependency_C:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   \- (com.example.external:dependency_E:jar:1.0.0:compile - omitted for conflict with 2.0.0)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the first project we see the maven dependency resolution mechanism has aligned <code>dependency_E</code> with version <code>1.0.0</code> while in the second project the resolution mechanism has aligned <code>dependency_E</code> with version <code>2.0.0</code>. Since both versions of <code>dependency_E</code> appear at the same depth it is the one which is first included in the dependency tree which will win.</p><p>Let&#x27;s now take a look at what we see in the aggregate SBOM.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency ref=&quot;pkg:maven/com.example.example2/dependency_A@1.0.0?type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_C@1.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_D@1.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_C@1.0.0?type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_E@1.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_E@1.0.0?type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_F@1.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_F@1.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_D@1.0.0?type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_E@1.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency ref=&quot;pkg:maven/com.example.example2/dependency_B@1.0.0?type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_D@1.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_C@1.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_E@2.0.0?type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_F@2.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_F@2.0.0?type=jar&quot;/&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>From the above we see there is a flow matching <code>A1-&gt;C1-&gt;E1-&gt;F1</code> and <code>A1-&gt;D1-&gt;E1-&gt;F1</code>, so the aggregated SBOM correctly represents the dependency hierarchy for <code>dependency_A</code>.</p><p>If we now look at how the dependency tree for <code>dependency_B</code> is represented we can again see a problem. The representation for <code>dependency_B</code> has flows from <code>B1-&gt;D1-&gt;E1-F1</code> and <code>B1-&gt;C1-&gt;E1-&gt;F1</code> which do not match the dependency hierarchy for <code>dependency_B</code> since it does not include <code>E1-&gt;F1</code> in its hierarchy! Where has the flow <code>E2-&gt;F2</code> gone? Unfortunately this flow is now orphaned with <code>E2</code> being its own root in the SBOM!</p><h1>Non Transitive Dependencies</h1><p>In this scenario we will take a look at how non-Transitive dependencies can impact the normal resolution process, and therefore the derived dependency trees. The non-Transitive dependencies could be those dependencies with scopes of either <code>provided</code> or <code>test</code>, or could be dependencies which are marked as being <code>optional</code>.</p><p>Project <code>dependency_A</code> will declare a dependency on <code>dependency_C</code> alongside an optional dependency on <code>dependency_E</code>, which causes a conflict which needs to be resolved. Project <code>dependency_B</code> will have a single dependency on <code>dependency_A</code>, consuming it as is.</p><p>Let us now take a look at the dependency hierarchy for both projects, as visualized through the dependency:tree plugin. For <code>dependency_A</code> we see</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">com.example.example3:dependency_A:jar:1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+- com.example.external:dependency_C:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  \- com.example.external:dependency_D:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|     \- (com.example.external:dependency_E:jar:1.0.0:compile - omitted for conflict with 2.0.0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\- com.example.external:dependency_E:jar:2.0.0:compile (scope not updated to compile)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   \- com.example.external:dependency_F:jar:2.0.0:compile</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>and for <code>dependency_B</code> we see</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">com.example.example3:dependency_B:jar:1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\- com.example.example3:dependency_A:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   \- com.example.external:dependency_C:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      \- com.example.external:dependency_D:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         \- com.example.external:dependency_E:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            \- com.example.external:dependency_F:jar:1.0.0:compile</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the first project we see the maven dependency resolution mechanism has aligned <code>dependency_E</code> with version <code>2.0.0</code> through the transitive dependency inherited via the <code>optional</code> dependency. In the second project the maven dependency resolution mechanism has ignored the optional dependency leaving the original dependency on <code>dependency_E:1.0.0</code>.</p><hr><p><strong>Note:</strong> While this example is making use of an optional dependency, the same tree would be generated if this dependency was of scope <code>test</code> or <code>provided</code>.</p><hr><p>Let&#x27;s now take a look at what we see in the aggregate SBOM.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency ref=&quot;pkg:maven/com.example.example3/dependency_A@1.0.0?type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_C@1.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_E@2.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_C@1.0.0?type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_D@1.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_D@1.0.0?type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_E@2.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_E@2.0.0?type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_F@2.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_F@2.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency ref=&quot;pkg:maven/com.example.example3/dependency_B@1.0.0?type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example.example3/dependency_A@1.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_E@1.0.0?type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_F@1.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency ref=&quot;pkg:maven/com.example.external/dependency_F@1.0.0?type=jar&quot;/&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>From the above we see there is a flow matching <code>A1-&gt;C1-&gt;D1-&gt;E2-&gt;F2</code> and <code>A1-&gt;E2-&gt;F2</code>, so the aggregated SBOM correctly represents the dependency hierarchy for <code>dependency_A</code>.</p><p>If we now look at how the dependency tree for <code>dependency_B</code> is represented we see a problem. The representation for <code>dependency_B</code> includes flows from <code>B1-&gt;A1-&gt;C1-&gt;D1-&gt;E2-&gt;F2</code> and <code>B1-&gt;A1-&gt;E2-&gt;F2</code>, neither of which match the dependency hierarchy for B; the hierarchy for <code>dependency_B</code> should be a flow of <code>B1-&gt;A1-&gt;C1-&gt;D1-&gt;E1-&gt;F1</code>! Not only has the flow <code>E1-&gt;F1</code> been orphaned from the <code>dependency_B</code> dependency tree, and now its own root, but the SBOM claims <code>dependency_B</code> has multiple dependency flows when it should only be a single flow.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="summarising-the-issue">Summarising the issue<a href="#summarising-the-issue" class="hash-link" aria-label="Direct link to Summarising the issue" title="Direct link to Summarising the issue">â</a></h2><p>We see from the above scenarios it is reasonably easy to end up with a multi-module project which results in an invalid expression of the project dependency trees within the aggregated SBOM, and we have still to look at exclusions and version management through the maven <code>dependencyManagement</code> declarations. To make matters worse we have no easy way of identifying whether the aggregated SBOM contains an invalid dependency graph. While it is possible the aggregated SBOM could contain orphaned dependency trees it is also possible those dependency trees would be consumed by other components within the SBOM.</p><p>Given the aggregate SBOM is no longer reliable the only safe approach is to rely on the individual SBOMs for each project, at least for now.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-can-we-solve-this">How can we solve this?<a href="#how-can-we-solve-this" class="hash-link" aria-label="Direct link to How can we solve this?" title="Direct link to How can we solve this?">â</a></h2><p>There is a solution for this, however the solution comes with implications which <em>may</em> break some tools which work with SBOMs. These tools will already be making invalid assumptions, and we will have to work with their authors to identify and fix any occurrences we find.</p><p>What is really lacking in the CycloneDX specification is a way in which we can easily describe alternative dependency hierarchies for a component, since as we have shown this is something which happens within the java space and likely other areas.</p><p>The CyloneDX specification defines the component dependency hierarchies by referring to the <code>components</code> themselves, through their references, however this reference also defines the unique hierarchy within the <code>dependencies</code> section. For example</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency ref=&quot;pkg:maven/org.owasp.webgoat.lesson/auth-bypass@v8.0.0.M15?type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/org.owasp.encoder/encoder@1.2?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.thoughtworks.xstream/xstream@1.4.7?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/org.apache.commons/commons-exec@1.3?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>ref</code> attribute <code>pkg:maven/org.owasp.webgoat.lesson/auth-bypass@v8.0.0.M15?type=jar</code> represents not only the specific component, tied through the component <code>bom-ref</code> attribute, but also a unique dependency hierarchy within the <code>dependencies</code> section. Given this how can we also represent the following hierarchy within the same aggregate SBOM?</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency ref=&quot;pkg:maven/org.owasp.webgoat.lesson/auth-bypass@v8.0.0.M15?type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/org.owasp.webgoat/webgoat-container@v8.0.0.M15?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/org.owasp.encoder/encoder@1.2?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.thoughtworks.xstream/xstream@1.4.7?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/org.projectlombok/lombok@1.16.20?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/org.apache.commons/commons-exec@1.3?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In order to achieve this we need to have some way of enriching the <code>ref</code> attribute value so it represents not only the specific component but also the direct dependencies in its particular location within the dependency graph, for example including a hash which would be derived from each set of dependencies. This hash would need to be calculated from the leaves back to the root, with every deviation in the dependency tree propagating its way up to the root.</p><p>We could then have a representation similar to the following</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ref=&quot;pkg:maven/org.owasp.webgoat.lesson/auth-bypass@v8.0.0.M15?hash=&lt;hash1&gt;&amp;amp;type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/org.owasp.encoder/encoder@1.2?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.thoughtworks.xstream/xstream@1.4.7?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/org.apache.commons/commons-exec@1.3?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ref=&quot;pkg:maven/org.owasp.webgoat.lesson/auth-bypass@v8.0.0.M15?hash=&lt;hash2&gt;&amp;amp;type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/org.owasp.webgoat/webgoat-container@v8.0.0.M15?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/org.owasp.encoder/encoder@1.2?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.thoughtworks.xstream/xstream@1.4.7?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/org.projectlombok/lombok@1.16.20?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/org.apache.commons/commons-exec@1.3?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><p><strong>Note:</strong> The child dependencies in the example above should also have a hash, however these have been omitted for brevity.</p><hr><p>The above would allow us to represent different hierarchies, but now we have another problem. Each reference used in the <code>dependencies</code> section <em>must</em> refer to an existing <code>component</code> within the <code>components</code> section and, therefore, we now need the <code>component</code> to be defined for each reference in use, e.g.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;component type=&quot;library&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bom-ref=&quot;pkg:maven/org.owasp.webgoat.lesson/auth-bypass@v8.0.0.M15?hash=&lt;hash1&gt;&amp;amp;type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;publisher&gt;OWASP&lt;/publisher&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;group&gt;org.owasp.webgoat.lesson&lt;/group&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;name&gt;auth-bypass&lt;/name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;version&gt;v8.0.0.M15&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;description&gt;Parent Pom for the WebGoat Project. A deliberately insecure Web Application&lt;/description&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;purl&gt;pkg:maven/org.owasp.webgoat.lesson/auth-bypass@v8.0.0.M15?type=jar&lt;/purl&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/component&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;component type=&quot;library&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bom-ref=&quot;pkg:maven/org.owasp.webgoat.lesson/auth-bypass@v8.0.0.M15?hash=&lt;hash2&gt;&amp;amp;type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;publisher&gt;OWASP&lt;/publisher&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;group&gt;org.owasp.webgoat.lesson&lt;/group&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;name&gt;auth-bypass&lt;/name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;version&gt;v8.0.0.M15&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;description&gt;Parent Pom for the WebGoat Project. A deliberately insecure Web Application&lt;/description&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;purl&gt;pkg:maven/org.owasp.webgoat.lesson/auth-bypass@v8.0.0.M15?type=jar&lt;/purl&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/component&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It is this change which, while not invalid according to the specification schema, will likely cause problems for tools which have made the assumption the component can only exist once.</p><h1>Conclusions</h1><p>There is a <a href="https://github.com/CycloneDX/cyclonedx-maven-plugin/pull/306" target="_blank" rel="noopener noreferrer">CycloneDX maven plugin PR</a> open to modify the plugin&#x27;s behaviour and generate an aggregate SBOM using the above hashing scheme, representing all the dependency hierarchies within a multi-module project. There is also an associated <a href="https://github.com/CycloneDX/cyclonedx-maven-plugin/issues/310" target="_blank" rel="noopener noreferrer">CycloneDX maven plugin issue</a> where the reasons for this change are still being discussed, as well as a number of discussions on how the specification can evolve to address this issue in a cleaner way.</p><p>I am hopeful we can come up with a suitable resolution to these discussions and deliver a solution to the issue, however until this is achieved the <code>dependencies</code> section of the aggregate SBOMs generated by the CycloneDX maven plugin is unreliable and should not be trusted. The only reliable source of dependency hierarchy information is to be found within the individual SBOMs of each project.</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/cyclonedx">cyclonedx</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/trustification/trustification.github.io/tree/main/blog/2023-03-20-cyclonedx-maven-aggregate-bom-why-not-to-trust.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/blog/2023/03/13/in-toto-attestations"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">in-toto attestations</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#summarising-the-issue" class="table-of-contents__link toc-highlight">Summarising the issue</a></li><li><a href="#how-can-we-solve-this" class="table-of-contents__link toc-highlight">How can we solve this?</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://app.element.io/?updated=1.11.32#/room/#trustification:matrix.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Matrix<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/trustification" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 Trustification.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.9aa82a53.js"></script>
<script src="/assets/js/main.a8b28ef1.js"></script>
</body>
</html>