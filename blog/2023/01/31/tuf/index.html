<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">The Update Framework (TUF) | Trustification</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://trustification.io/img/logo.svg"><meta data-rh="true" name="twitter:image" content="https://trustification.io/img/logo.svg"><meta data-rh="true" property="og:url" content="https://trustification.io/blog/2023/01/31/tuf"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="keywords" content="supply chain, sbom, vex"><meta data-rh="true" property="og:title" content="The Update Framework (TUF) | Trustification"><meta data-rh="true" name="description" content="TUF seems to pop again and again when learning about Secure Supply-Chain"><meta data-rh="true" property="og:description" content="TUF seems to pop again and again when learning about Secure Supply-Chain"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-01-31T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/danbev"><link data-rh="true" rel="icon" href="/img/logo.svg"><link data-rh="true" rel="canonical" href="https://trustification.io/blog/2023/01/31/tuf"><link data-rh="true" rel="alternate" href="https://trustification.io/blog/2023/01/31/tuf" hreflang="en"><link data-rh="true" rel="alternate" href="https://trustification.io/blog/2023/01/31/tuf" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://UO35LKIYPP-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Trustification RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Trustification Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-HWS6R519CF"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-HWS6R519CF",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Trustification" href="/opensearch.xml">

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Red+Hat+Text&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Red+Hat+Text:wght@400;700&display=swap"><link rel="stylesheet" href="/assets/css/styles.17054ea6.css">
<link rel="preload" href="/assets/js/runtime~main.9aa82a53.js" as="script">
<link rel="preload" href="/assets/js/main.6ac7478a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Trustification Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="Trustification Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Trustification</b></a><a href="https://docs.trustification.dev/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Documentation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/trustification" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/03/20/cyclonedx-maven-aggregate-bom-why-not-to-trust">The CycloneDX Maven Aggregate SBOM and why you shouldn&#x27;t trust it (yet)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/03/13/in-toto-attestations">in-toto attestations</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/02/13/elfsign">Signing elf binaries, or not?! Lessons learned.</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/02/10/cyclonedx-maven-plugin-adventure-continues">Continuing the Adventure with the CycloneDX Maven Plugin</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/2023/01/31/tuf">The Update Framework (TUF)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/01/25/keys">Is this a cryptographic key which I see before me?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/01/13/sigstore-bundle-format">Sigstore bundle format</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/01/11/sigstore-in-toto-opa">Sigstore, in-toto, OPA, orientation</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/12/09/cyclonedx-maven-plugin-adventure">An Adventure with the CycloneDX Maven Plugin</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/12/05/gitsign-cache">How to Configure a Gitsign Cache</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">The Update Framework (TUF)</h1><div class="container_mt6G margin-vert--md"><time datetime="2023-01-31T00:00:00.000Z" itemprop="datePublished">January 31, 2023</time> · <!-- -->20 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/danbev" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/danbev.png" alt="Daniel Bevenius"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/danbev" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Daniel Bevenius</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer</small></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p>TUF seems to pop again and again when learning about Secure Supply-Chain
Security (SSCS). The goal of this post is to get some hands-on experience
with TUF, showing examples that will hopefully clarify TUF concepts, and
the reason for using it in projects like Sigstore.</p><p>As the name &quot;The Update Framework&quot; implies this is a framework for update
systems, and doing so in a secure way. What is getting updated could be
anything, it could be software packages, source files, certificates, public
keys, etc. And by following this &quot;framework&quot;, updates can be performed in a
secure way.</p><p>Producers want the things they produce to be available to consumers, and they
want to make sure that consumers are getting updates for these things. I&#x27;m using
&quot;things&quot; just to make it clear that this does not have to be software packages
which might be what first comes to mind.</p><p>Lets take a look what this might look like without TUF:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  +-----------+     +---------------------+                      +----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Producer  |     | Distribution server |                      | Consumer |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |-----------+     |---------------------+                      |----------|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | thing_v1  | --&gt; | thing_v1            | -------------------&gt; | thing_v1 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  +-----------+     +---------------------+                      +----------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So we have a producer that has something that it makes available to consumer&#x27;s
via a distribution server. The consumer uses this thing by downloading it from
the distribution server in some manner. If the distribution server just allows
the consumer to poll and download the thing/artifact, then it will be up to the
consumer code to decide when it should poll to check for updates and update if
needed.</p><p>For example, lets say that a man in the middle (MITM) attack is put in place
and the consumer is no longer talking to the distribution server but instead
to server controlled by an attacker which provides the consumer with a malicious
artifacts:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  +-----------+     +---------------------+     +----------+     +----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Producer  |     | Distribution server |     | MITM     |     | Consumer |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |-----------+     |---------------------+     |          |     |----------|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | thing_v1  | --&gt; | thing_v1            |     | evil_v1  | --&gt; | thing_v1 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  +-----------+     +---------------------+     +----------+     +----------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>An attacker may also target the distribution server itself and modify the
artifacts that the consumers download:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  +-----------+     +---------------------+                      +----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Producer  |     | Distribution server |                      | Consumer |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |-----------+     |---------------------+                      |----------|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | thing_v1  | --&gt; | thing_v1 (evil_v1)  | ------------------&gt;  | thing_v1 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  +-----------+     +---------------------+                      +----------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This type of attack is refered to as <code>Arbitary software installation</code>.</p><p>Another attack against the distribution server is where the attacker prevents
the consumer from getting updates, and instead provides the consumer with an
older version which might contain a known vulnerabilty.</p><p>This would be the current state where the correct/latest version is being used:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  +-----------+     +---------------------+                      +----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Producer  |     | Distribution server |                      | Consumer |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |-----------+     |---------------------+                      |----------|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | thing_v3  | --&gt; | thing_v3            | ------------------&gt;  | thing_v3 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  +-----------+     +---------------------+                      +----------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The attacker then changes the version on the distribution server to an older
version, causing the consumer to downgrade, or rollback to that version:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  +-----------+     +---------------------+                      +----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Producer  |     | Distribution server |                      | Consumer |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |-----------+     |---------------------+                      |----------|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | thing_v3  | --&gt; | thing_v2 (evil_v2)  | ------------------&gt;  | thing_v2 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  +-----------+     +---------------------+                      +----------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This type of attack is refered to as <code>Rollback attack</code>.</p><p>There are other <a href="https://theupdateframework.io/security/" target="_blank" rel="noopener noreferrer">attacks</a> but these
I found helped me better understand the metadata that is provided by TUF.</p><p>A simplified overview of this can be seen below and I&#x27;m going into more
details later in the document.</p><p>What I&#x27;d like to convey with this is that the producer will update the TUF
repository by creating <code>metadata</code> about the artifact(s) that are going to be
made available. This metadata is signed by one or more keys.
The motivation for signing is that we want to prevent the situation above where
an attacker is able to replace an artifact with an older version, or a modified
version. Having the metadata signed for each version means that it would not be
possible for an attacker to do this as the TUF client framework will verify
signatures.</p><p>In TUF, the &quot;distribution server&quot; in the above scenarios will have a TUF
repository integrated into it. This repository will be updated by the producer,
and the consumer in the above scenarios will be replaced by a TUF client:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  +-----------+         +---------------------+               +------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Producer  |         | TUF Repository      | &lt;-----------  | TUF Client       |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |-----------+ update  |---------------------+               |------------------|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | thing_v1  | ------&gt; | Metadata (signed)   | ------------&gt; | Metadata (signed)|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  +-----------+         +---------------------+               +------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                ------------&gt; | thing_v1         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                              +------------------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Notice that in addition to the metadata that exists on the TUF repository there
is also metadata on the TUF consumer/client side. This metadata is downloaded
and frequently resigned, and it has an short expiration date. This is how the
TUF framework enforces updates actually take place. Because the TUF client
framework checks the expiration and the signature of the metadata file, it
can detect if the expiration date has passed. If there has not been any updates
and the expiration date has passed, perhaps a certain number of times, it can
take action to notify the client side software about this situation. This is how
TUF can enforce that updates actually get applied to the consumer.</p><p>This metadata is also signed as we don&#x27;t want an attacker to be able to serve
the client with a metadata file they crafted themselves, which might have
enabled the attacker to trick the consumer into thinking that there are no
updates and force the consumer to be stuck on an older version.</p><p>Hopefully this has provided an overview and some idea about the metadata and
the signing in TUF. Later we will see a concrete example of the metadata files
to get &quot;feel&quot; for what they look like.</p><p>So, we have mentioned metadata files and signing. The following is an attempt
to visualize where the metadata files exist.</p><p>Initially, we would have the following metadata files:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  +-----------+         +---------------------+               +---------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Producer  |         | TUF Repository      |               | TUF Consumer  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |-----------+ update  |---------------------+               |---------------|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Keys      | ------&gt; | Metadata            |               | Metadata      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  +-----------+         | 1.root.json         |               | root.json     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Metadata  |         | 1.targets.json      |               +---------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | root.json |         | 1.snapshot.json     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  +-----------+         | timestamp.json      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | thing_v1  |         +---------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  +-----------+         | thing_v1            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        +---------------------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Initially, before the client has interacted with the TUF repository, the client
has a trusted root.json metadata file. This file is shipped with the client and
it does not matter if it&#x27;s expire date has passed, as it will get updated once
the client interacts with the TUF reporitory which is part of the client
<a href="https://theupdateframework.github.io/specification/latest/index.html#detailed-client-workflow" target="_blank" rel="noopener noreferrer">workflow</a>
of TUF&#x27;s specification.</p><p>The client starts by <a href="https://theupdateframework.github.io/specification/latest/index.html#load-trusted-root" target="_blank" rel="noopener noreferrer">loading</a> this trusted root file.</p><p>Next, client proceeds to the <a href="https://theupdateframework.github.io/specification/latest/index.html#update-root" target="_blank" rel="noopener noreferrer">download</a> \&lt;version<!-- -->&gt;<!-- -->.root.json files from the TUF repository until it has
reached the latest:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  +-----------+         +---------------------+               +---------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Producer  |         | TUF Repository      | &lt;-----------  | TUF Consumer  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |-----------+ update  |---------------------+               |---------------|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Keys      | ------&gt; | Metadata            | ------------&gt; | Metadata      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  +-----------+         | 1.root.json         |               | root.json     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Metadata  |         | 1.targets.json      |               +---------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | root.json |         | 1.snapshot.json     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  +-----------+         | timestamp.json      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | thing_v1  |         +---------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  +-----------+         | thing_v1            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        +---------------------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Notice that the root.json is written on the client side without the version
prefix. This will be used to verify the files that are download later.</p><p>Next, the client will <a href="https://theupdateframework.github.io/specification/latest/index.html#update-timestamp" target="_blank" rel="noopener noreferrer">download</a> the timestamp metadata file:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  +-----------+         +---------------------+               +---------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Producer  |         | TUF Repository      | &lt;-----------  | TUF Consumer  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |-----------+ update  |---------------------+               |---------------|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Keys      | ------&gt; | Metadata            | ------------&gt; | Metadata      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  +-----------+         | 1.root.json         |               | root.json     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Metadata  |         | 1.targets.json      |               | timestamp.json|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | root.json |         | 1.snapshot.json     |               +---------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  +-----------+         | timestamp.json      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | thing_v1  |         +---------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  +-----------+         | thing_v1            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        +---------------------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And there will number of verifications performed on timestamp.json.</p><p>Next, the client will <a href="https://theupdateframework.github.io/specification/latest/index.html#update-snapshot" target="_blank" rel="noopener noreferrer">download</a> the snapshot metadata file:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  +-----------+         +---------------------+               +---------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Producer  |         | TUF Repository      | &lt;-----------  | TUF Consumer  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |-----------+ update  |---------------------+               |---------------|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Keys      | ------&gt; | Metadata            | ------------&gt; | Metadata      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  +-----------+         | 1.root.json         |               | root.json     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Metadata  |         | 1.targets.json      |               | timestamp.json|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | root.json |         | 1.snapshot.json     |               | snapshot.json |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  +-----------+         | timestamp.json      |               +---------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | thing_v1  |         +---------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  +-----------+         | thing_v1            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        +---------------------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And there will number of verifications performed on snapshot.json.</p><p>Next, the client will <a href="https://theupdateframework.github.io/specification/latest/index.html#update-targets" target="_blank" rel="noopener noreferrer">download</a> the targets.json metadata file:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  +-----------+         +---------------------+               +---------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Producer  |         | TUF Repository      | &lt;-----------  | TUF Consumer  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |-----------+ update  |---------------------+               |---------------|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Keys      | ------&gt; | Metadata            | ------------&gt; | Metadata      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  +-----------+         | 1.root.json         |               | root.json     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Metadata  |         | 1.targets.json      |               | timestamp.json|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | root.json |         | 1.snapshot.json     |               | snapshot.json |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  +-----------+         | timestamp.json      |               | targets.json  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | thing_v1  |         +---------------------+               +---------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  +-----------+         | thing_v1            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        +---------------------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And there will number of verifications performed on targets.json.</p><p>Finally, the client will <a href="https://theupdateframework.github.io/specification/latest/index.html#fetch-target" target="_blank" rel="noopener noreferrer">fetch</a> the actual target files, these are the actual artifacts.</p><p>The names of the metadata files are named after the four top level roles in TUF:</p><ul><li><code>Root</code> Delegates trust to specific keys for all the other top level roles</li><li><code>Target</code> Signs metadata for the target files</li><li><code>Snapshot</code> Signs metadata about the latest version of targets metadata</li><li><code>Timestamp</code> Signs metadata about the latest version of the snapshot metadata</li></ul><p>The following sections will take a closer look at these metadata files.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="root-metadata">Root Metadata<a href="#root-metadata" class="hash-link" aria-label="Direct link to Root Metadata" title="Direct link to Root Metadata">​</a></h4><p>Instead of having a single root key, there will often be multiple root keys
which are stored in different offline locations, meaning that they are not
accessible remotely. These are often hardware keys, like Yubikeys.</p><p>Root keys are often used together to sign other keys. These non-root keys can
then be re-signed/revoked/rotated if/when needed.</p><p>Each role has metadata associated with it, and the specification defines a
canonical json format for them. So there would be a root.json, a targets.json,
a, timestamps.json, and a snapshot.json.</p><p>So what do these file look like?</p><p>Lets try this out by using a tool called
<a href="https://github.com/awslabs/tough/tree/develop/tuftool" target="_blank" rel="noopener noreferrer">tuftool</a>:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ cargo install --force tuftool</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="root-metadata-1">Root metadata<a href="#root-metadata-1" class="hash-link" aria-label="Direct link to Root metadata" title="Direct link to Root metadata">​</a></h4><p>Next we initiate a new <code>root.json</code> file using the following command:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tuftool root init root/root.json</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This command will generate a file named <code>root/root.json</code>:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ cat root/root.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;signed&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;_type&quot;: &quot;root&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;spec_version&quot;: &quot;1.0.0&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;consistent_snapshot&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;version&quot;: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;expires&quot;: &quot;2023-01-17T07:48:23Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;keys&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;roles&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;timestamp&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;keyids&quot;: [],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;threshold&quot;: 1507</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;root&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;keyids&quot;: [],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;threshold&quot;: 1507</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;snapshot&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;keyids&quot;: [],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;threshold&quot;: 1507</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;targets&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;keyids&quot;: [],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;threshold&quot;: 1507</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;signatures&quot;: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>These are just the default values, and we can see that there are no root keys,
that field is just an empty object, and notice that the roles are mainly empty
apart from the <code>threshold</code> values which is 1507. The threshold value specifies
the minimum number of keys required to sign that roles metadata. 1507 is a large
number of keys and we can change this to just requiring one key:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tuftool root set-threshold root/root.json snapshot 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ tuftool root set-threshold root/root.json root 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ tuftool root set-threshold root/root.json timestamp 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ tuftool root set-threshold root/root.json targets 1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And we can see that <code>root/root.json</code> has been updated:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ cat root/root.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;signed&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;_type&quot;: &quot;root&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;spec_version&quot;: &quot;1.0.0&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;consistent_snapshot&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;version&quot;: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;expires&quot;: &quot;2023-02-27T14:05:04Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;keys&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;roles&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;root&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;keyids&quot;: [],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;threshold&quot;: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;targets&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;keyids&quot;: [],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;threshold&quot;: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;snapshot&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;keyids&quot;: [],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;threshold&quot;: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;timestamp&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;keyids&quot;: [],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;threshold&quot;: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;signatures&quot;: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can also set the expire time for the root using the following command:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tuftool root expire root/root.json &#x27;in 6 weeks&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now, to sign anything we will need a private key to create the signatures and
a matching public key to be used to verify signatures.</p><p>We can generate a root key and one can be generated using
<code>tuftool root gen-rsa-key</code>:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tuftool root gen-rsa-key root/root.json ./keys/root.pem --role root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6e99ec437323f2c7334c8b16fd7a7a197829ba89ff50d07aa4b50fc9634dad9f</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This will generate keys/root.pem which is a private key in pkcs8 format. The
hex value printed above is the <code>key_id</code> which will be used later to reference
this key in metadata files.</p><p>Now, if we again inspect <code>root.json</code> we find that a key has been added:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ cat root/root.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;signed&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;_type&quot;: &quot;root&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;spec_version&quot;: &quot;1.0.0&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;consistent_snapshot&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;version&quot;: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;expires&quot;: &quot;2023-02-28T08:30:48Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;keys&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;6e99ec437323f2c7334c8b16fd7a7a197829ba89ff50d07aa4b50fc9634dad9f&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;keytype&quot;: &quot;rsa&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;keyval&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;public&quot;: &quot;-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA5ZiWzak3CBJkRrCfw5GO\nSUtYjIK2jLozyaZ44FePW/KYEhM8LyHcNz9lwx45tZ8gId4AsxGBj9fhsOgjpN7l\nMPXpaKsV/5f37HzQLCrbldz3ei9LkMWG5La4Cwil0qPDpTxfzI7IWDKk6l4/epgi\nOrAJDaQ/mKhH5OZ485JYuDIE7a0jplU/GvsNeCdZVMEQ8dko/CA4Di8lPkDRRdSw\naC/8g3K6mF+87ADdGOmZ+LFodLEPvqIVljece2JlX2z44Io3N7Y5FH63Az4H3MFL\nDPZJH5lFs7Lb/fHx25rWSE2/GHcUUTs4oScPp2X0hAnblOsmCFSCjf8Kb0R7dLUb\nnQIDAQAB\n-----END PUBLIC KEY-----&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;scheme&quot;: &quot;rsassa-pss-sha256&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;roles&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;timestamp&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;keyids&quot;: [],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;threshold&quot;: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;targets&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;keyids&quot;: [],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;threshold&quot;: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;root&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;keyids&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;6e99ec437323f2c7334c8b16fd7a7a197829ba89ff50d07aa4b50fc9634dad9f&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;threshold&quot;: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;snapshot&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;keyids&quot;: [],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;threshold&quot;: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;signatures&quot;: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Notice that the <code>keys</code> object has a field which is named after the <code>key_id</code> and
that the <code>root</code> role has this <code>key_id</code> in its <code>keyids</code> array. This <code>key_id</code> is
created from the json value of the fields <code>keytype</code>, <code>keyval</code>, and <code>scheme</code>,
which is then canonicalized before hashed using sha256. We can inspect/verify
this using a tool named <a href="https://github.com/danbev/tuf-keyid" target="_blank" rel="noopener noreferrer">tuf-keyid</a>, and
passing in the above json field of the public key:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tuf-keyid --json=&#x27;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;keytype&quot;: &quot;rsa&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;keyval&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              &quot;public&quot;: &quot;-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA5ZiWzak3CBJkRrCfw5GO\nSUtYjIK2jLozyaZ44FePW/KYEhM8LyHcNz9lwx45tZ8gId4AsxGBj9fhsOgjpN7l\nMPXpaKsV/5f37HzQLCrbldz3ei9LkMWG5La4Cwil0qPDpTxfzI7IWDKk6l4/epgi\nOrAJDaQ/mKhH5OZ485JYuDIE7a0jplU/GvsNeCdZVMEQ8dko/CA4Di8lPkDRRdSw\naC/8g3K6mF+87ADdGOmZ+LFodLEPvqIVljece2JlX2z44Io3N7Y5FH63Az4H3MFL\nDPZJH5lFs7Lb/fHx25rWSE2/GHcUUTs4oScPp2X0hAnblOsmCFSCjf8Kb0R7dLUb\nnQIDAQAB\n-----END PUBLIC KEY-----&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;scheme&quot;: &quot;rsassa-pss-sha256&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">key_id: SHA256:6e99ec437323f2c7334c8b16fd7a7a197829ba89ff50d07aa4b50fc9634dad9f</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And we can see that the <code>key_id</code>&#x27;s produced are the same. This may be obvious
but just to be clear, <code>keys</code> only includes the public key.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="targets-metadata">Targets metadata<a href="#targets-metadata" class="hash-link" aria-label="Direct link to Targets metadata" title="Direct link to Targets metadata">​</a></h4><p>The Target role is a role that signs metadata files that describe the
project artifacts, like software packages, source code, or whatever artifacts
that are to be consumed by TUF clients/consumers.</p><p>So lets add a target key, and we will use the same private key as before:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tuftool root add-key root/root.json ./keys/root.pem --role targets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6e99ec437323f2c7334c8b16fd7a7a197829ba89ff50d07aa4b50fc9634dad9f</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This will update the <code>targets</code> role in <code>root.json</code>:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ jq &#x27;.signed.roles.targets&#x27; &lt; root/root.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;keyids&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;6e99ec437323f2c7334c8b16fd7a7a197829ba89ff50d07aa4b50fc9634dad9f&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;threshold&quot;: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="snapshot-metadata">Snapshot metadata<a href="#snapshot-metadata" class="hash-link" aria-label="Direct link to Snapshot metadata" title="Direct link to Snapshot metadata">​</a></h4><p>The Snapshot roles signs a metadata file which contains information about the
latest version of the targets metadata. This is used to identify which versions
of a target are in a repository at a certain time. This is used to know if there
is an update available (remember it&#x27;s call The Update Framework).</p><p>So, lets add a key to the snapshot role:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tuftool root add-key root/root.json ./keys/root.pem --role snapshot</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And we can see that following change to <code>root.json</code>:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ jq &#x27;.signed.roles.snapshot&#x27; &lt; root/root.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;keyids&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;6e99ec437323f2c7334c8b16fd7a7a197829ba89ff50d07aa4b50fc9634dad9f&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;threshold&quot;: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="timestamp-metadata">Timestamp metadata<a href="#timestamp-metadata" class="hash-link" aria-label="Direct link to Timestamp metadata" title="Direct link to Timestamp metadata">​</a></h4><p>Finally, we have the timestamp role which tells if there is an update.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tuftool root add-key root/root.json ./keys/root.pem --role timestamp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And we can see that following change to <code>root.json</code>:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ jq &#x27;.signed.roles.timestamp&#x27; &lt; root/root.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;keyids&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;6e99ec437323f2c7334c8b16fd7a7a197829ba89ff50d07aa4b50fc9634dad9f&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;threshold&quot;: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="signing-rootjson">Signing root.json<a href="#signing-rootjson" class="hash-link" aria-label="Direct link to Signing root.json" title="Direct link to Signing root.json">​</a></h4><p>So we have configured which keys to be used for each of the roles but we have
not signed this metadata file. We need to sign it to prevent tampering of it
as it will be sent to the TUF repository, usually on server but for this
example everything will be on the local file system.</p><p>We can now sign root.json using the following command:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tuftool root sign ./root/root.json -k ./keys/root.pem</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And we can check <code>root.json</code> that the signatures field has been updated with
a keyid and a signature.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> jq &#x27;.signatures&#x27; &lt; root/root.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;keyid&quot;: &quot;6e99ec437323f2c7334c8b16fd7a7a197829ba89ff50d07aa4b50fc9634dad9f&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;sig&quot;: &quot;8e7c7ca88e242ff360af30ba83e0ccfd9de2a9dee774166abe508ad2757620d6439bc7a5163c55867e069812a21ba31b7097d9ded3590f03f8bdc7106755a9ae840efbfe9b6c7d69e047230c59f3bd682e83f0b5b9c271d6db60943f7fa57d565790de58687560b50951a363725471c3a8f64c3980385eb214876bb1fe87d4aefc5cdd557bd022ddd794a52368f8502c1944185c75827ca97bba8fd5cdd5bb41b7ad76f0105072fbee980d3dbbf9889ec223ea1399228560fd747bc03a378d3ba93990560b000d02a59aab04844ec70662f8baaee33f8591f5bbe3126fb057f9b3055d498005220d1715c92166506995e89f2e8e62d1032452d51ba6579eb0e2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="generate-the-tuf-repository">Generate the TUF repository<a href="#generate-the-tuf-repository" class="hash-link" aria-label="Direct link to Generate the TUF repository" title="Direct link to Generate the TUF repository">​</a></h4><p>With <code>root.json</code> and the private key we can generate a tuf repository using the
following command:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tuftool create \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --root root/root.json \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --key keys/root.pem \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --add-targets artifacts \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --targets-expires &#x27;in 3 weeks&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --targets-version 1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --snapshot-expires &#x27;in 3 weeks&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --snapshot-version 1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --timestamp-expires &#x27;in 1 week&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --timestamp-version 1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --outdir repo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>That command will create a directory named <code>repo</code> which contains two
directories, <code>metadata</code> and <code>targets</code>.</p><p>Let start by looking at the <code>targets</code> directory:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ls -l repo/targets/01ab0faaf41a4543df1fa218b8e9f283d07536339cf11d2afae9d116a257700c.artifact_1.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lrwxrwxrwx. 1 danielbevenius danielbevenius 79 Jan 17 12:50 repo/targets/01ab0faaf41a4543df1fa218b8e9f283d07536339cf11d2afae9d116a257700c.artifact_1.txt -&gt; artifacts/artifact_1.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Notice that the name of this link is the sha256sum of the contents of
artifact_1.txt file:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ sha256sum  artifacts/artifact_1.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">01ab0faaf41a4543df1fa218b8e9f283d07536339cf11d2afae9d116a257700c  artifacts/artifact_1.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And we can check the size of this file using:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ stat -c &quot;%s&quot; artifact_1.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">24</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The reason for showing this values is that they are referred to in the next
section.</p><p>Now, lets take a look at the <code>metadata</code> directory.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ls repo/metadata/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1.root.json  1.snapshot.json  1.targets.json  timestamp.json</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The number prefix is the version, to 1.targets.json is for version 1 for
example.</p><p>Lets start by looking at <code>targets.json</code>:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;signed&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;_type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;targets&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;spec_version&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1.0.0&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;version&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;expires&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2023-02-07T11:50:00.608598188Z&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;targets&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;artifact_1.txt&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;length&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">24</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;hashes&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;sha256&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;01ab0faaf41a4543df1fa218b8e9f283d07536339cf11d2afae9d116a257700c&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;delegations&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;keys&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;roles&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;signatures&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;keyid&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;6e99ec437323f2c7334c8b16fd7a7a197829ba89ff50d07aa4b50fc9634dad9f&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;sig&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;48b9810f275e16acb2d093c5487da4107f2312e0c9e084f6974aa836661a0e87d341be37fe84a4afd6ba82e8e54301e01a7431a0e69d3bef95ce3e34d90badff3c4a19ed7a6cea2a4ec69c6dc7392fde1f20b1246f3113ace85a223bfc54203a9254e82c8cd9686b8b973bfc41cdda657ff707a41c3db125b61dfc41c8937896f7fcc0ea17429a934b9c0fee912ca4df4a3b1dac6811968aa34bbf2d3327bbeab9cad1dadc1f8134c0add4267bf8ff285c066d24ea39b24d9bca197bf9762025133205612d41b167ee1232adf8c122320d77b70b936817ddf2cc93732228f772078b663f3fc896ec8873873414ba44fd3e28772589f69af06ee3e1297e0b2b37&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Notice that the <code>hashes</code> object has a single field which is the sha256sum of
the file <code>artifacts_1.txt</code>, and that <code>length</code> matches the size which we showed
in the previous section.</p><p>We have information about the targets, in this case on a single file named
artifact_1.txt, and this is the file that a client wants to consume. This
metadata file is signed and the signature in the <code>sig</code> field of the
<code>signatures</code> array.</p><p>Again, this needs to be signed to prevent an attacker from modifying the targets
and modifying the <code>length</code>, and <code>sha256</code> fields which would otherwise allow them
to replace the target artifact with a potentially malicious version.</p><p>Next, lets take a look at the <code>snapshots.json</code> metadata file:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ cat repo/metadata/1.snapshot.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;signed&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;_type&quot;: &quot;snapshot&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;spec_version&quot;: &quot;1.0.0&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;version&quot;: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;expires&quot;: &quot;2023-02-07T11:50:00.608597347Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;meta&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;targets.json&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;length&quot;: 1048,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;hashes&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;sha256&quot;: &quot;896781ff1260ed4ad5b05a004b034279219dc92b64068a2cc376604e8a6821c9&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;version&quot;: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;signatures&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;keyid&quot;: &quot;6e99ec437323f2c7334c8b16fd7a7a197829ba89ff50d07aa4b50fc9634dad9f&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;sig&quot;: &quot;5a8d9597329183c52547591d1abc8e36c1535d81c0e51ed51d95d2ddf1ec2076f2412ba8e631f039c7bf9e5a14cdd44eb7a5c7dae5dcc84e6aa2ebd51049ee791cf3c3dc486af26731fc06ba39e449ef85b102247c4254cb48784e4a95b54943df9e668470a6def79c7c3d532a68e93d18f1d59f1636455dddec0b5960afeb5a9ac38c38c6891e6f819f22aed7996a7f9964d655d634a940e1234f2015caa8f4f710570443bc0bc3ec04117c3dc97c8d564f42489cc499593f6232b7f5062646644aecafaf50dc9a4005a000f6720b0b9c455e5b92d7a1bcfb96f14a6a9da162e9b091497b0eb24283a837ba1d15ff67f12d104b1c5e1d83c36ae49400bb326e&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So looking at the above <code>meta</code> field, we can see that there is a <code>targets.json</code>
&quot;meta path&quot;. If we search for this file we won&#x27;t be able to find it. The actual
file is prefixed with the version from the <code>version</code> field. So the file in
question is <code>repo/metadata/1.targets.json</code>, and we can check the size of this
file using:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ stat -c &quot;%s&quot; repo/metadata/1.targets.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1048</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And that matches the <code>length</code> field above.</p><p>And we also can check the hash using:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ sha256sum repo/metadata/1.targets.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">896781ff1260ed4ad5b05a004b034279219dc92b64068a2cc376604e8a6821c9  repo/metadata/1.targets.json</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The snapshot metadata file tells us which versions of metadata files
existed for a specific version. Even though we only have one version currently
in our example, a real world repositories would have multiple versions of
metadata files. The purpose of the snapshot.json file is to prevent an attacker
from including metadata files from another version in some version:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">       TUF Repository              TUF Client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     +----------------+           +----------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | timestamp.json | --------&gt; | timestamp.json |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | 1.targets.json | version 3 | - version 3    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | 2.targets.json | &lt;-------  |                |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | 3.targets.json | version 2 |                |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     |                | --------&gt; |                |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     +----------------+           +----------------+kk</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above is trying to show that the client has received a timestamp.json,
which we will discuss shortly, with a version number of 3. The client proceeds
to retrieve this version update from the TUF server. Now if an attacker was able
to include other metadata files, which are available in the TUF repository only
they are not part of the request version, it would be possible for them those
targets to be sent to the client.Having the <code>snapshot.json</code> prevents this as
it specifies which metadata files are included in a specific version and no
other additional metadata files that may exist in the TUF repository are
included.</p><p>So that leaves us with <code>timestamp.json</code>. This is a file that is downloaded by
the client and usually has a short expiration date. As mentioned before this is
the part that allows the system to enforce that updates are actually reaching
consumers, and if they are not they allow the consumer to take action.</p><p>The metadata looks like this:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ cat repo/metadata/timestamp.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;signed&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;_type&quot;: &quot;timestamp&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;spec_version&quot;: &quot;1.0.0&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;version&quot;: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;expires&quot;: &quot;2023-01-24T11:50:00.608598985Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;meta&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;snapshot.json&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;length&quot;: 1004,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;hashes&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;sha256&quot;: &quot;b92c443c21b6bc15d4f3991491e8bcb201f66a26ab289fb8cc9af7f851530872&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;version&quot;: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;signatures&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;keyid&quot;: &quot;6e99ec437323f2c7334c8b16fd7a7a197829ba89ff50d07aa4b50fc9634dad9f&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;sig&quot;: &quot;3708f055fe58b2c70e92cbc46bd9cc0f3149900bf25b3e924ff666eb8b45187df8d1f064b249cd790c170b5e97b322866d298d527ff950d2fbcbf508097868afca34ebaa159890799155c6bb615bab9a8bcfc34a39574584716d9a89b531fce97d876884fad2db69dc8f3569870dee280e87c9d506b5b08698e7c23e7dbbf4a3209fbc91ec764b54bf87367145cbb7bc9d7edaf47f709355284315fac9167312833d990e9e064852bb4fa905ec4edb5fe051480e70d505694528c5e9b47fefc3b78f6e54623f93344511326bdeec392a5eac31e7299bf9f602036d9f9524810eb03c4720370250f3e9f503e8d5bee94a6e6539ca9f988a27272d47612fd03436&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Notice that <code>snapshot.json</code> is refering to the file <code>1.timestamp.json</code> in the
TUF repository.</p><p>Finally, we have repo/metadata/1.root.json which is identical to root/root.json
which we saw previously as this is the only version we have in our repository.</p><p>What we have been doing is setting up a repository which would be most often
exist on on a server somewhere.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tuf-clientconsumer">TUF client/consumer<a href="#tuf-clientconsumer" class="hash-link" aria-label="Direct link to TUF client/consumer" title="Direct link to TUF client/consumer">​</a></h3><p>A consumer of the artifact would use a TUF client library to download the
artifacts, and would specify the metadata and targets to download.</p><p>To make this more concrete we have created a very basic <a href="https://github.com/danbev/tuf-client#readme" target="_blank" rel="noopener noreferrer">example</a>
which is intended to show how one such client library, in this case
<a href="https://crates.io/crates/tough" target="_blank" rel="noopener noreferrer">tough</a>, might be used. Please refer to the
example&#x27;s README.md for details.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tuf-usage-in-sigstore">TUF usage in Sigstore<a href="#tuf-usage-in-sigstore" class="hash-link" aria-label="Direct link to TUF usage in Sigstore" title="Direct link to TUF usage in Sigstore">​</a></h3><p>Armed with the above knowledge, lets take a look at how Sigstore uses TUF.</p><p>The <a href="https://github.com/sigstore/root-signing/tree/main/repository" target="_blank" rel="noopener noreferrer">root-signing</a>
repository has a directory which contains the TUF repository metadata.</p><p>Sigstore uses TUF to protect their public keys and certificates, which was one
reason for trying to say &quot;things&quot; instead of software updates in the text above.
So the artifacts that are updated are public keys and certificates. As of this
writing these are the current <a href="https://github.com/sigstore/root-signing/blob/0ce4aa6c45c3ee709766d90e34c6b1372ad4b29a/repository/repository/targets.json" target="_blank" rel="noopener noreferrer">targets</a>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fulcio.crt.pem  Fulico (CA) certificate.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rekor.pub       Rekor public key.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ctfe.pub        Certificate Transparency log public key used to verify</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                signed certificate timestamps.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">artifact.pub    Public key which is used to verify Sigstore releases, like</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Cosign, Rekor, and Fulcio releases.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There are more than four in the actual file but they are different versions. The
four listed here just explain the usage of these keys. In the case of
sigstore-rs only the Fulio certificate, and Rekor&#x27;s public key are used. We will
focus on these in this post.</p><p>The <a href="https://github.com/sigstore/root-signing/blob/main/repository/repository/root.json" target="_blank" rel="noopener noreferrer">root.json</a>
can also be found in the same directory and hopefully this should look familar
after seeing the root.json earlier.</p><p>We also learned earlier that the initial trusted <code>root.json</code> is shipped with the
software in some manner. In sigstore-rs, <code>root.json</code> is a constant named
<a href="https://github.com/sigstore/sigstore-rs/blob/8d22a6d23a6771688c8206850524a2b1076bbdb0/src/tuf/constants.rs#L30-L173" target="_blank" rel="noopener noreferrer">SIGSTORE_ROOT</a> in the crate itself.</p><p>sigstore-rs uses the <code>tough</code> crate just like the example we saw earlier, and
similar to the <a href="https://github.com/danbev/tuf-client/blob/3adca52130c69f242ef24c5845c91ee1612fc64c/src/main.rs#L61" target="_blank" rel="noopener noreferrer">example</a>, creates a tough <a href="https://github.com/sigstore/sigstore-rs/blob/cef673776548c9b268e0ce8ecc3a4fe2da504658/src/tuf/repository_helper.rs#L43" target="_blank" rel="noopener noreferrer">RepositoryLoader</a> in a RepositoryHelper
struct. A RepositoryHelper is created in SigstoreRepository&#x27;s
<a href="https://github.com/sigstore/sigstore-rs/blob/cef673776548c9b268e0ce8ecc3a4fe2da504658/src/tuf/mod.rs#L123" target="_blank" rel="noopener noreferrer">fetch</a> method, and the <code>Fulcio certificate</code>, and <code>Rekor&#x27;s public key</code> are read from
the repository, similar to how <code>artifact.txt</code> was read in the example:</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    let repository_helper = RepositoryHelper::new(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SIGSTORE_ROOT.as_bytes(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        metadata_base,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        target_base,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        checkout_dir,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )?;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let fulcio_certs = repository_helper.fulcio_certs()?;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let rekor_pub_key = repository_helper.rekor_pub_key().map(|data| {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String::from_utf8(data).map_err(|e| {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            SigstoreError::UnexpectedError(format!(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;Cannot parse Rekor&#x27;s public key obtained from TUF repository: {}&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    })??;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There is a caching layer in-between the call to <code>fulcio_certs</code> but after
that, and if there is a cache miss, the actual call the TUF repository can
be found in <a href="https://github.com/sigstore/sigstore-rs/blob/cef673776548c9b268e0ce8ecc3a4fe2da504658/src/tuf/repository_helper.rs#L158" target="_blank" rel="noopener noreferrer">fetch_target</a>:</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/// Download a file from a TUF repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fn fetch_target(repository: &amp;tough::Repository, target_name: &amp;TargetName) -&gt; Result&lt;Vec&lt;u8&gt;&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let data: Vec&lt;u8&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match repository.read_target(target_name)? {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        None =&gt; Err(SigstoreError::TufTargetNotFoundError(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            target_name.raw().to_string(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Some(reader) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            data = read_to_end(reader)?;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Ok(data)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And this is simliar to how in the example above we <a href="https://github.com/danbev/tuf-client/blob/3adca52130c69f242ef24c5845c91ee1612fc64c/src/main.rs#L69-L71" target="_blank" rel="noopener noreferrer">downloaded</a> <code>artifact.txt</code> like this:</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    let artifact = repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .read_target(&amp;TargetName::from_str(&quot;artifact.txt&quot;).unwrap())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .unwrap();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>By using the TUF framework for Fulcio&#x27;s certificate, and Rekor&#x27;s public keys
these can be updated in a secure manner like described previously in this post.</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col margin-top--sm"><a href="https://github.com/trustification/trustification.github.io/tree/main/blog/2023-01-31-tuf.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/2023/02/10/cyclonedx-maven-plugin-adventure-continues"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Continuing the Adventure with the CycloneDX Maven Plugin</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/2023/01/25/keys"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Is this a cryptographic key which I see before me?</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#tuf-clientconsumer" class="table-of-contents__link toc-highlight">TUF client/consumer</a></li><li><a href="#tuf-usage-in-sigstore" class="table-of-contents__link toc-highlight">TUF usage in Sigstore</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docs.trustification.dev/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Documentation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://app.element.io/?updated=1.11.32#/room/#trustification:matrix.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Matrix<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/trustification" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Trustification.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.9aa82a53.js"></script>
<script src="/assets/js/main.6ac7478a.js"></script>
</body>
</html>