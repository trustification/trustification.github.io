<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">An Adventure with the CycloneDX Maven Plugin | Trustification</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://trustification.io/img/logo.svg"><meta data-rh="true" name="twitter:image" content="https://trustification.io/img/logo.svg"><meta data-rh="true" property="og:url" content="https://trustification.io/blog/2022/12/09/cyclonedx-maven-plugin-adventure"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="keywords" content="supply chain, sbom, vex"><meta data-rh="true" property="og:title" content="An Adventure with the CycloneDX Maven Plugin | Trustification"><meta data-rh="true" name="description" content="The CycloneDX Maven Plugin can be used to generate CycloneDX Software Bill of Materials (SBOM) for your maven projects as part of your build process. The plugin is easy to integrate, however does have some issues due mostly to idiosyncrasies and shortcomings with the maven resolution mechanism. In this post I attempt to provide some background, examples and explanations for the issues I&#x27;ve discovered as well as context for the solutions I&#x27;m proposing."><meta data-rh="true" property="og:description" content="The CycloneDX Maven Plugin can be used to generate CycloneDX Software Bill of Materials (SBOM) for your maven projects as part of your build process. The plugin is easy to integrate, however does have some issues due mostly to idiosyncrasies and shortcomings with the maven resolution mechanism. In this post I attempt to provide some background, examples and explanations for the issues I&#x27;ve discovered as well as context for the solutions I&#x27;m proposing."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-12-09T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/knrc"><meta data-rh="true" property="article:tag" content="cyclonedx"><link data-rh="true" rel="icon" href="/img/logo.svg"><link data-rh="true" rel="canonical" href="https://trustification.io/blog/2022/12/09/cyclonedx-maven-plugin-adventure"><link data-rh="true" rel="alternate" href="https://trustification.io/blog/2022/12/09/cyclonedx-maven-plugin-adventure" hreflang="en"><link data-rh="true" rel="alternate" href="https://trustification.io/blog/2022/12/09/cyclonedx-maven-plugin-adventure" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://UO35LKIYPP-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://trustification.io/blog/2022/12/09/cyclonedx-maven-plugin-adventure","mainEntityOfPage":"https://trustification.io/blog/2022/12/09/cyclonedx-maven-plugin-adventure","url":"https://trustification.io/blog/2022/12/09/cyclonedx-maven-plugin-adventure","headline":"An Adventure with the CycloneDX Maven Plugin","name":"An Adventure with the CycloneDX Maven Plugin","description":"The CycloneDX Maven Plugin can be used to generate CycloneDX Software Bill of Materials (SBOM) for your maven projects as part of your build process. The plugin is easy to integrate, however does have some issues due mostly to idiosyncrasies and shortcomings with the maven resolution mechanism. In this post I attempt to provide some background, examples and explanations for the issues I've discovered as well as context for the solutions I'm proposing.","datePublished":"2022-12-09T00:00:00.000Z","author":{"@type":"Person","name":"Kevin Conner","description":"Maintainer","url":"https://github.com/knrc","image":"https://github.com/knrc.png"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://trustification.io/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Trustification RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Trustification Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-HWS6R519CF"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-HWS6R519CF",{anonymize_ip:!0})</script>



<link rel="search" type="application/opensearchdescription+xml" title="Trustification" href="/opensearch.xml">

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Red+Hat+Text&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Red+Hat+Text:wght@400;700&display=swap"><link rel="stylesheet" href="/assets/css/styles.a6dfedec.css">
<script src="/assets/js/runtime~main.b380581c.js" defer="defer"></script>
<script src="/assets/js/main.01a50e20.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Trustification Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Trustification Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Trustification</b></a><a href="https://docs.trustification.dev/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Documentation<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/trustification" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Meta+k)" aria-keyshortcuts="Meta+k"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="11" cy="11" r="8" stroke="currentColor" fill="none" stroke-width="1.4"></circle><path d="m21 21-4.3-4.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025/07/04/release-0-3-2">Trustify: Release 0.3.2</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2024/07/04/release-0-1-0-alpha-10">Trustify: Release 0.1.0-alpha.10</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2024/06/27/trying-out-trustify">Trying out Trustify, on a local machine</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2023</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/03/20/cyclonedx-maven-aggregate-bom-why-not-to-trust">The CycloneDX Maven Aggregate SBOM and why you shouldn&#x27;t trust it (yet)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/03/13/in-toto-attestations">in-toto attestations</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">An Adventure with the CycloneDX Maven Plugin</h1><div class="container_mt6G margin-vert--md"><time datetime="2022-12-09T00:00:00.000Z">December 9, 2022</time> · <!-- -->16 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/knrc" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://github.com/knrc.png" alt="Kevin Conner"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://github.com/knrc" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp" translate="no">Kevin Conner</span></a></div><small class="authorTitle_nd0D" title="Maintainer">Maintainer</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>The CycloneDX Maven Plugin can be used to generate CycloneDX Software Bill of Materials (SBOM) for your maven projects as part of your build process. The plugin is easy to integrate, however does have some issues due mostly to idiosyncrasies and shortcomings with the maven resolution mechanism. In this post I attempt to provide some background, examples and explanations for the issues I&#x27;ve discovered as well as context for the solutions I&#x27;m proposing.</p>
<p>Three weeks ago I started an adventure with the <a href="https://github.com/CycloneDX/cyclonedx-maven-plugin" target="_blank" rel="noopener noreferrer" title="The CycloneDX Maven Plugin GitHub repository">CycloneDX Maven Plugin</a>, investigating how we could make use of this plugin to generate Software Bill of Materials (SBOMs) for the <a href="https://github.com/quarkusio/quarkus" target="_blank" rel="noopener noreferrer" title="The Quarkus GitHub repository">Quarkus</a> project. At first this goal appeared easy to achieve, simply enable the plugin for all projects within the <strong>Quarkus</strong> build (hello parent pom.xml) and verify the generated <em>bom</em> contents were accurate.</p>
<p>As I had expected, enabling the plugin was very straight forward. I created a profile in the top level <em>pom.xml</em> to capture the information required at compile time, incorporating all artifacts using <em>compile</em>, <em>provided</em> and <em>system</em> maven scopes. I chose not to include any <em>test</em> or <em>runtime</em> artifacts.</p>
<p>Once the BOM files were created I looked for a way to verify the output was reasonable. I turned to the <a href="https://github.com/apache/maven-dependency-plugin" target="_blank" rel="noopener noreferrer" title="The Maven Dependency Plugin GitHub repository">maven dependency plugin</a> and its <em>tree</em> goal, along with a fairly straight forward script to compare the information in the generated dependency tree with that in the <em>bom</em> file and highlight any discrepancies. This is where the fun began    😁</p>
<p>The remainder of those three weeks involved many hours with a debugger, walking through the internals of maven as well as the CycloneDX plugin, identifying the causes of these discrepancies and working through fixes to generate the output I believed should have been included in the <em>bom</em> files.</p>
<hr>
<p><strong>Note:</strong> At this time these changes have neither been discussed nor reviewed by the CycloneDX community, I&#x27;ve reached out to them via slack and am hoping we can find time to go through this in detail over the next few weeks or so. In the meantime treat this article as my opinions of what I believe should be done.</p>
<hr>
<h1>Part Two - The Case of the Missing Dependency</h1>
<p>Before we talk about missing dependencies we first need to take a quick refresher for how maven resolves artifacts within a project.</p>
<p>One of the benefits of maven is its ability to automatically derive the dependency tree for your project using the information in your <em>pom.xml</em> combined with the information in the <em>pom.xml</em> for each of your transitive dependencies. Maven will take this information and create a dependency tree where each artifact exists once (not always the case, but we will come on to that), will favour artifacts which are closer to the root of the tree than those farther away, reconcile their versions based on the defined constraints and derive an appropriate scope.</p>
<p>The example used in the maven documentation is as follows</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">A</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   └── C</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       └── D 2.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── E</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── D 1.0</span><br></span></code></pre></div></div>
<p>As the shortest path to <strong>D</strong> is via E, the generated dependency tree will look like</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">A</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   └── C</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── E</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── D 1.0</span><br></span></code></pre></div></div>
<p>With the above refresher out of the way let&#x27;s move on to the issue of missing dependencies and consider the following example</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">com.example:trustification:jar:1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+- com.example:dependency1:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  \- com.example:dependency2:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|     \- com.example:shared_dependency1:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|       \- com.example:shared_dependency2:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\- com.example:test_dependency:jar:1.0.0:test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   \- com.example:shared_dependency1:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      \- com.example:shared_dependency2:jar:1.0.0:compile</span><br></span></code></pre></div></div>
<p>In this graph we can see that <strong>com.example<!-- -->:dependency2</strong> and <strong>com.example<!-- -->:test_dependency</strong> both depend on <strong>com.example<!-- -->:shared_dependency1</strong>, with <strong>dependency2</strong> having a scope of <em>compile</em> and <strong>test_dependency</strong> having a scope of <em>test</em>. When this graph is processed by maven we end up with a dependency tree which is close to the example given in the maven documentation.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">com.example:trustification:jar:1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+- com.example:dependency1:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  \- com.example:dependency2:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\- com.example:test_dependency:jar:1.0.0:test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   \- com.example:shared_dependency1:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      \- com.example:shared_dependency2:jar:1.0.0:compile</span><br></span></code></pre></div></div>
<p>Each artifact exists once and the <strong>shared_dependency1</strong> artifact is now seen only under the <strong>test_dependency</strong> artifact.</p>
<p>Only this isn&#x27;t the full picture.</p>
<p>What is actually taking place under the covers is that each set of conflicts within the graph is being evaluated in order to decide which one is chosen (the winning artifact), with all losing artifacts then being updated and turned into a marker artifact without child dependencies. We can see a visualisation of this by enabling the <em>verbose</em> flag on the <em>dependency:tree</em> goal (use version 3.4.0), which displays the underlying dependency tree and not the clean version.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">com.example:trustification:jar:1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+- com.example:dependency1:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  \- com.example:dependency2:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|     \- (com.example:shared_dependency1:jar:1.0.0:compile - omitted for duplicate)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\- com.example:test_dependency:jar:1.0.0:test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   \- com.example:shared_dependency1:jar:1.0.0:compile (scope not updated to compile)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      \- com.example:shared_dependency2:jar:1.0.0:compile</span><br></span></code></pre></div></div>
<p>We can now see that the <strong>shared_dependency1</strong> artifact exists multiple times and that the dependency under <strong>dependency2</strong> lost the conflict resolution to the dependency under <strong>test_dependency</strong>.</p>
<p>How do we end up with missing dependencies? This happens when we filter the graph using scopes, which in my case includes <em>compile</em>, <em>provided</em> and <em>system</em>. Let&#x27;s take a look at what happens under those circumstances.</p>
<p>Maven&#x27;s DependencyCollectorBuilder works by first generating the dependency tree, with conflicts resolved as above, then pruning the result to remove subtrees which are not accepted by the filter. In my case this means any artifacts which do not have the right scope, along with their dependent children, will be removed. The tree returned to the CycloneDX plugin will be as follows</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">com.example:trustification:jar:1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\- com.example:dependency1:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   \- com.example:dependency2:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      \- (com.example:shared_dependency1:jar:1.0.0:compile - omitted for duplicate)</span><br></span></code></pre></div></div>
<p>The CycloneDX plugin will process this tree and create the following dependency graph within the <em>bom</em> file</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependencies&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example/trustification@1.0.0?type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;dependency ref=&quot;pkg:maven/com.example/dependency1@1.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example/dependency1@1.0.0?type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;dependency ref=&quot;pkg:maven/com.example/dependency2@1.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example/dependency2@1.0.0?type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;dependency ref=&quot;pkg:maven/com.example/shared_dependency1@1.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example/shared_dependency1@1.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependencies&gt;</span><br></span></code></pre></div></div>
<p>This is notable for two reasons</p>
<ol>
<li>The bom contains the <em>shared_dependency1</em> artifact even though this entry came from the marker entry (we can make use of this)</li>
<li>We have lost the <em>shared_dependency2</em> artifact since it is only present under the pruned <em>test</em> scoped subtree.</li>
</ol>
<p>In order to see a representation of the graph I would like in the <em>bom</em> we simply need to comment out the <em>test</em> dependency in the top level <em>pom.xml</em>, which would result in the following dependency tree</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">com.example:trustification:jar:1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\- com.example:dependency1:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   \- com.example:dependency2:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      \- com.example:shared_dependency1:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         \- com.example:shared_dependency2:jar:1.0.0:compile</span><br></span></code></pre></div></div>
<p>and the following dependency graph in the <em>bom</em></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependencies&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example/trustification@1.0.0?type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;dependency ref=&quot;pkg:maven/com.example/dependency1@1.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example/dependency1@1.0.0?type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;dependency ref=&quot;pkg:maven/com.example/dependency2@1.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example/dependency2@1.0.0?type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;dependency ref=&quot;pkg:maven/com.example/shared_dependency1@1.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example/shared_dependency1@1.0.0?type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;dependency ref=&quot;pkg:maven/com.example/shared_dependency2@1.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example/shared_dependency2@1.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependencies&gt;</span><br></span></code></pre></div></div>
<p>How can we fix this while including the test artifact as a dependency? We can rely on the following information</p>
<ul>
<li>the marker artifact has been included in the filtered result tree, however it is without children</li>
<li>the full dependency tree contains a <em>winner</em> artifact which contains any dependent children</li>
</ul>
<p>We can then follow this process</p>
<ul>
<li>retrieve the full dependency tree</li>
<li>collect all children from top level <em>test</em> scoped dependencies</li>
<li>search the original tree looking for potential marker artifacts, i.e. those without children, then<!-- -->
<ul>
<li>check the set of hidden artifacts to see if the potential marker artifact is also hidden</li>
<li>if the hidden artifact does exist then transplant its dependencies to the marker artifact</li>
</ul>
</li>
</ul>
<p>The above will allow us to reconstruct the missing parts of the SBOM dependency graph and create my desired <em>bom</em> content.</p>
<hr>
<p><strong>Note:</strong> The same issue will occur with <em>runtime</em> scoped artifacts within the graph, these can also conceal <em>compile</em> scoped artifacts if closer to the root. The difference between <em>test</em> scoped artifacts and those with <em>runtime</em> scope is that the <em>runtime</em> scoped artifacts can exist anywhere in the dependency tree whereas the <em>test</em> artifacts will only be found at the top level. The <em>runtime</em> artifacts can be handled by following a similar process to the one above, extended to the full dependency tree.</p>
<hr>
<h1>Part Three - Should Consistency Matter?</h1>
<p>In going through the <em>bom</em> file we can see that the information is split into two major types, <strong>Components</strong> and <strong>Dependencies</strong>. My expectation was that this information would be consistent, with these elements being related as follows</p>
<ul>
<li>each <strong>Dependency</strong> being associated with a <strong>Component</strong></li>
<li>each nested <strong>Dependency</strong> referencing an existing top level <strong>Dependency</strong> element</li>
<li>each <strong>Component</strong> being associated with a top level <strong>Dependency</strong></li>
</ul>
<p>One of the verification tests I ran on the <em>bom</em> files was to test these expectations, and while I did not discover any issues with the <strong>Dependencies</strong> I did discover numerous examples of <strong>Components</strong> existing without any associated dependency information.</p>
<p>We can revisit the example from earlier to explain why this happens. The CycloneDX code decides which components to include based on the set of resolved artifacts derived from the full dependency tree, and it does this separately from determining the filtered dependency graph. The only connection between the two is that, when generating the dependency graph, the existing process will check whether the dependency has an associated <em>Component</em> before adding it to the graph. If the <em>Component</em> has not been created then the dependency will be ignored.</p>
<p>As a reminder, here&#x27;s the example we covered earlier as seen by CycloneDX when processing the dependency graph.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">com.example:trustification:jar:1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+- com.example:dependency1:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  \- com.example:dependency2:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|     \- (com.example:shared_dependency1:jar:1.0.0:compile - omitted for duplicate)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\- com.example:test_dependency:jar:1.0.0:test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   \- com.example:shared_dependency1:jar:1.0.0:compile (scope not updated to compile)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      \- com.example:shared_dependency2:jar:1.0.0:compile</span><br></span></code></pre></div></div>
<p>And the following represents the set of resolved artifacts used to determine which <em>Components</em> and <em>Dependencies</em> are included in the SBOM dependency graph, assuming we are generating the <em>bom</em> based on the <em>compile</em> scope.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">com.example:trustification:jar:1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+- com.example:dependency1:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  \- com.example:dependency2:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\- &lt;test artifact ignored&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   \- com.example:shared_dependency1:jar:1.0.0:compile (scope not updated to compile)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      \- com.example:shared_dependency2:jar:1.0.0:compile</span><br></span></code></pre></div></div>
<p>There are two issues with this that I can see</p>
<ul>
<li>this will generate <em>Components</em> for all <em>compile</em> scope artifacts in the tree, including <strong>shared_dependency2</strong> from the test subtree</li>
<li>this ignores the cumulative scopes used by maven when filtering the artifacts to create the dependency tree, relying instead on an explicit test of equality</li>
</ul>
<p>All of the instances I have discovered so far have been related to the missing dependency issue from <a href="#part-two---the-case-of-the-missing-dependency">Part Two</a>, and are addressed by ensuring concealed artifacts are included in the SBOM dependency graph, however I am not yet convinced this is the only circumstance under which this would occur with the current codebase.</p>
<hr>
<p><strong>Note:</strong> The Maven cumulative scopes are as follows</p>
<ul>
<li>compile -&gt; system, provided and compile</li>
<li>runtime -&gt; compile and runtime</li>
<li>test -&gt; system, provided, compile, runtime and test</li>
</ul>
<hr>
<p>Another related issue, coupled with the processing of excluded types, is the possibility of creating split dependency graphs within the same SBOM.</p>
<p>Consider the following dependency tree</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">com.example:trustification:jar:1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+- com.example:dependency1:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  \- com.example:dependency2:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\- com.example:type_dependency:test-jar:tests:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   \- com.example:shared_type_dependency1:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      \- com.example:shared_type_dependency2:jar:1.0.0:compile</span><br></span></code></pre></div></div>
<p>If we create the SBOM for the above tree, and choose to exclude artifacts of type <em>test-jar</em> from the graph, the current approach will result in two dependency graphs being generated. The first would be rooted at <strong>com.example<!-- -->:trustification</strong> and the second would be rooted at <strong>com.example<!-- -->:shared_type_dependency1</strong>. This is another consequence of the <em>Component</em> creation process, since only the specific <strong>com.example:type_dependency<!-- -->:test-jar</strong> artifact will be removed from the graph and not its dependencies. This results in the following dependency section within the <em>bom</em>.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependencies&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;!-- the first dependency graph is rooted here --&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example/trustification@1.0.0?type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;dependency ref=&quot;pkg:maven/com.example/dependency1@1.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example/dependency1@1.0.0?type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;dependency ref=&quot;pkg:maven/com.example/dependency2@1.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example/dependency2@1.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;!-- the second dependency graph is rooted here --&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example/shared_type_dependency1@1.0.0?type=jar&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;dependency ref=&quot;pkg:maven/com.example/shared_type_dependency2@1.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency ref=&quot;pkg:maven/com.example/shared_type_dependency2@1.0.0?type=jar&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependencies&gt;</span><br></span></code></pre></div></div>
<p>If we move the processing of the excluded types to the creation of the SBOM dependency graph we could address this issue and create only a single dependency graph for the root artifact, however without also addressing how we determine which <em>Components</em> are included in the <em>bom</em> we would be creating another source for inconsistencies and those now excluded artifacts would still exist in the <em>Components</em> section.</p>
<p>I believe a better approach would be to start with the assumption that all artifacts are included as <em>Components</em>, generate the dependency graph with type exclusion, and then prune all unreferenced components from the generated <em>bom</em>. Please remember this for now, it will come up again in the next part.</p>
<h1>Part Four - The Return of the Missing Dependency</h1>
<p>In <a href="#part-two---the-case-of-the-missing-dependency">Part Two</a> we discussed what happened when the dependency resolution led to parts of the dependency tree being concealed by artifacts with <em>test</em> or <em>runtime</em> scopes, however one edge case we did not cover is when the dependency is itself the <em>test</em> scoped artifact. In the current CycloneDX implementation this will cause the <em>test</em> artifact, and its children, to be ignored because of the mechanism used to determine which <em>Components</em> are included in the <em>bom</em>. Recall from <a href="#part-three---should-consistency-matter">Part Three</a> that dependencies will not be included in the dependency graph unless they already have an associated <em>Component</em>.</p>
<p>We can show this in action by looking at a modified version of the earlier example, depicted by <em>dependency:tree</em> as follows</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">com.example:trustification:jar:1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+- com.example:dependency1:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  \- (com.example:test_dependency:jar:1.0.0:compile - omitted for duplicate)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\- com.example:test_dependency:jar:1.0.0:test (scope not updated to compile)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   \- com.example:shared_dependency1:jar:1.0.0:test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      \- com.example:shared_dependency2:jar:1.0.0:test</span><br></span></code></pre></div></div>
<p>One fact we should be aware of is that the only real <em>test</em> scoped artifacts in the tree will be at the top level, Maven will ignore lower level <em>test</em> scoped artifacts when determining the transitive graph. In this case <strong>test_dependency</strong> is the only true <em>test</em> scoped artifact, and as neither <strong>shared_dependency1</strong> not <strong>shared_dependency2</strong> are referenced from a <em>compile</em> scope they only have a scope of <em>test</em> by inheriting it from the parent. Compare this with the example we used previously, when <strong>shared_dependency1</strong> was referenced from a <em>compile</em> scope.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">com.example:trustification:jar:1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+- com.example:dependency1:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  \- com.example:dependency2:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|     \- (com.example:shared_dependency1:jar:1.0.0:compile - omitted for duplicate)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\- com.example:test_dependency:jar:1.0.0:test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   \- com.example:shared_dependency1:jar:1.0.0:compile (scope not updated to compile)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      \- com.example:shared_dependency2:jar:1.0.0:compile</span><br></span></code></pre></div></div>
<p>What I would like to see is the SBOM dependency graph represented as follows</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">com.example:trustification:jar:1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+- com.example:dependency1:jar:1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   \- com.example:test_dependency:jar:1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      \- com.example:shared_dependency1:jar:1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         \- com.example:shared_dependency2:jar:1.0.0</span><br></span></code></pre></div></div>
<p>This can be fixed by following a similar process to that discussed in <a href="#part-two---the-case-of-the-missing-dependency">Part Two</a>, however it will also require us to move away from the current mechanism of identifying <em>Components</em> and relying on those references to restrict which <em>Artifacts</em> can be included in the dependency graph. Instead of the existing mechanism we would start from the assumption that all Artifacts will be included, determine the actual dependency graph, and then use this to prune the set of <em>Components</em> down to the required set.</p>
<p>Once this switch is made we can finally include those remaining missing dependencies in the graph and address the issues from <a href="#part-three---should-consistency-matter">Part Three</a>, we certainly have a number of reasons for doing so.</p>
<p>There are a few implementation details we do need to be aware of when switching approaches</p>
<ul>
<li>we need to consider excluded types, as moving their processing to the creation of the dependency graph will allow us to correctly handle their subtrees, however they can now also conceal parts of the dependency graph</li>
<li>we need to ensure we do not inadvertently pull in <em>runtime</em> scoped artifacts when reconstructing the graph from concealed dependencies</li>
</ul>
<h1>Conclusions</h1>
<p>This has been an interesting journey, and through it I&#x27;ve learned a lot about CycloneDX and more than I had likely wanted to know about the implementation of Maven. I have addressed all of the issues I believe to be present with the current approach, with the exception of one. While it is true that we can reconstruct the dependency tree to include concealed artifacts, the information provided directly by maven is insufficient to resolve all cases. The edge case identified in <a href="#part-four---the-return-of-the-missing-dependency">Part Four</a> covers the inclusion of <em>compile</em> scoped artifacts which are referenced through a top level <em>test</em> artifact, however there is also the case of <em>runtime</em> artifacts being included which, unfortunately, also have their scopes modified to a <em>test</em> scope.</p>
<p>By way of example, if we were to change the scope of the <strong>shared_dependency1</strong> dependency within the <strong>test_dependency</strong> pom.xml to a scope of <strong>runtime</strong> we would still see the following returned by maven</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">com.example:trustification:jar:1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+- com.example:dependency1:jar:1.0.0:compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  \- (com.example:test_dependency:jar:1.0.0:compile - omitted for duplicate)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\- com.example:test_dependency:jar:1.0.0:test (scope not updated to compile)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   \- com.example:shared_dependency1:jar:1.0.0:test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      \- com.example:shared_dependency2:jar:1.0.0:test</span><br></span></code></pre></div></div>
<p>As things currently stand we now have a <em>bom</em> file which is no longer missing dependencies, although it may include the occasional <em>runtime</em> scoped artifact when it really shouldn&#x27;t. In order to fix this edge case we will need to go deeper into the maven level and look at the underlying graph generated by <a href="https://wiki.eclipse.org/Aether" target="_blank" rel="noopener noreferrer" title="Eclipse Aether website">Eclipse Aether</a> as this contains more useful information.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Node: com.example:trustification:1.0.0    {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Node: com.example:dependency1:1.0.0    {conflict.originalScope=compile, conflict.originalOptionality=false}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Node: com.example:test_dependency:1.0.0    {conflict.winner=com.example:test_dependency:jar:1.0.0 (test), conflict.originalScope=compile, conflict.originalOptionality=false}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Node: com.example:test_dependency:1.0.0    {REDUCED_SCOPE=compile, conflict.originalScope=test, conflict.originalOptionality=false}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Node: com.example:shared_dependency1:1.0.0    {conflict.originalScope=runtime, conflict.originalOptionality=false}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Node: com.example:shared_dependency2:1.0.0    {conflict.originalScope=compile, conflict.originalOptionality=false}</span><br></span></code></pre></div></div>
<p>The above information contains the original scope of the dependencies, the optionality and also a reference to the winning dependency in the case of conflict.</p>
<p>Switching over to using this tree would likely be intrusive, and not something I would like to do without building up the existing test cases within the project. This is definitely a task for another day 😁</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/cyclonedx">cyclonedx</a></li></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><a href="https://github.com/trustification/trustification.github.io/tree/main/blog/2022-12-09-cyclonedx-maven-plugin-adventure.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/2023/01/11/sigstore-in-toto-opa"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Sigstore, in-toto, OPA, orientation</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/2022/12/05/gitsign-cache"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">How to Configure a Gitsign Cache</div></a></nav></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docs.trustification.dev/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Documentation<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://app.element.io/?updated=1.11.32#/room/#trustification:matrix.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Matrix<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/trustification" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Trustification.</div></div></div></footer></div>
</body>
</html>